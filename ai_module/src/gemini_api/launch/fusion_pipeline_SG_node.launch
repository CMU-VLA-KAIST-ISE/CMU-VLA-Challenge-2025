<launch>
  <!-- Topic args -->
  <arg name="camera_image_topic"      default="/camera/image"/>
  <arg name="cloud_topic_a"           default="/color_scan_rel"/>
  <arg name="cloud_topic_b"           default="/color_scan_relative"/>
  <arg name="prompt_topic"            default="/instruction"/>

  <!-- Frames -->
  <arg name="map_frame"               default="map"/>
  <arg name="waypoint_frame"          default="map"/>

  <!-- Dump / naming -->
  <arg name="dump_dir"                default="/tmp/fusion_faas"/>
  <arg name="scene_name"              default="$(optenv current_scene_name unknown_scene)"/>
  <arg name="region_name"             default="livingroom"/>

  <!-- Waypoint behavior -->
  <arg name="use_waypoint_interface"  default="true"/>
  <arg name="waypoint_only_if_single" default="true"/>
  <arg name="waypoint_publish_rate"   default="10.0"/>
  <arg name="waypoint_publish_duration" default="6.0"/>

  <!-- SG params -->
  <arg name="sg_enable"               default="true"/>
  <arg name="sg_near_dist"            default="0.8"/>
  <arg name="sg_overlap_ratio"        default="0.2"/>
  <arg name="sg_on_gap"               default="0.15"/>
  <arg name="sg_above_gap"            default="0.2"/>
  <arg name="sg_lr_thresh"            default="0.2"/>
  <arg name="sg_fb_thresh"            default="0.2"/>
  <arg name="sg_between_lat_thresh"   default="0.3"/>
  <arg name="sg_between_max_pairs"    default="2"/>

  <!-- python 인터프리터(3.10) 강제 -->
  <arg name="python" default="/opt/conda/envs/python310/bin/python3"/>

  <node pkg="gemini_api"
        type="fusion_pipeline_SG_node.py"
        name="fusion_pipeline_node"
        output="screen"
        launch-prefix="$(arg python)">
    <param name="gemini_api_key" value="$(env GEMINI_API_KEY)"/>
    <param name="camera_image_topic" value="$(arg camera_image_topic)"/>
    <param name="cloud_topic_a"      value="$(arg cloud_topic_a)"/>
    <param name="cloud_topic_b"      value="$(arg cloud_topic_b)"/>
    <param name="prompt_topic"       value="$(arg prompt_topic)"/>

    <param name="map_frame"          value="$(arg map_frame)"/>

    <param name="dump_dir"           value="$(arg dump_dir)"/>
    <param name="scene_name"         value="$(arg scene_name)"/>
    <param name="region_name"        value="$(arg region_name)"/>

    <param name="use_waypoint_interface"   value="$(arg use_waypoint_interface)"/>
    <param name="waypoint_only_if_single"  value="$(arg waypoint_only_if_single)"/>
    <param name="waypoint_frame"           value="$(arg waypoint_frame)"/>
    <param name="waypoint_publish_rate"    value="$(arg waypoint_publish_rate)"/>
    <param name="waypoint_publish_duration" value="$(arg waypoint_publish_duration)"/>

    <param name="sg_enable"                value="$(arg sg_enable)"/>
    <param name="sg_near_dist"             value="$(arg sg_near_dist)"/>
    <param name="sg_overlap_ratio"         value="$(arg sg_overlap_ratio)"/>
    <param name="sg_on_gap"                value="$(arg sg_on_gap)"/>
    <param name="sg_above_gap"             value="$(arg sg_above_gap)"/>
    <param name="sg_lr_thresh"             value="$(arg sg_lr_thresh)"/>
    <param name="sg_fb_thresh"             value="$(arg sg_fb_thresh)"/>
    <param name="sg_between_lat_thresh"    value="$(arg sg_between_lat_thresh)"/>
    <param name="sg_between_max_pairs"     value="$(arg sg_between_max_pairs)"/>
    <param name="dump_dir" value="/home/$USER/CMU-VLA-Challenge/runs/fusion_faas"/>

    <!-- Gemini model / misc -->
    <param name="gemini_model"       value="gemini-2.5-flash"/>
    <param name="min_points"         value="30"/>
    <param name="cooldown_sec"       value="10.0"/>
    <param name="publish_goal_on_single" value="false"/>

    <!-- Camera/Lidar extrinsics -->
    <param name="camera/width"       value="1920"/>
    <param name="camera/height"      value="640"/>
    <param name="camera/hfov_deg"    value="360.0"/>
    <param name="camera/vfov_deg"    value="120.0"/>

    <param name="l2c/x" value="-0.12"/>
    <param name="l2c/y" value="-0.075"/>
    <param name="l2c/z" value="0.265"/>
    <param name="l2c/roll"  value="-1.5707963"/>
    <param name="l2c/pitch" value="0.0"/>
    <param name="l2c/yaw"   value="-1.5707963"/>

    <param name="lidar/x" value="0.0"/>
    <param name="lidar/y" value="0.0"/>
    <param name="lidar/z" value="0.0"/>
    <param name="lidar/roll"  value="0.0"/>
    <param name="lidar/pitch" value="0.0"/>
    <param name="lidar/yaw"   value="0.0"/>
  </node>
</launch>
